<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Dashboard Template for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    {% load static %}
    <link href="{% static "bootstrap/css/home.css" %}" rel="stylesheet" type="text/css"/>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    {#    <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">#}

    <!-- Custom styles for this template -->
    <link href="dashboard.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    {#    <script src="../../assets/js/ie-emulation-modes-warning.js"></script>#}

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>
<div id="main">
<section >
    <!-- 左侧菜单-->
    <aside class="aside menu" style="width: auto;">
        <div class="container-fluid">
            <div class="row">
                <div class="menuDiv" role="navigation">
                    <!--
                            nav-pills 胶囊标签
                            nav-stacked 垂直堆叠
                            -->
                    <ul class="nav nav-list nav-first">
                        <div class="container-fluid">
                            <li><a>丽呈测试管理系统</a></li>
                        </div>
                        <li class="active">
                            <a href="#">
                            <span class="icon-left glyphicon glyphicon-home" aria-hidden="true">
                            </span>
                            <span>
                                首页
                            </span>
                        </a>
                        </li>
                        <li><a href="#"><span class="icon-left glyphicon glyphicon-th"
                                              aria-hidden="true"></span><span>项目管理</span></a></li>
                        <li><a href="#"><span class="icon-left glyphicon glyphicon-stats"
                                              aria-hidden="true"></span><span>接口自动化</span></a></li>
                        <li>
                            <a href="#">
                                <span class="icon-left glyphicon glyphicon-transfer" aria-hidden="true"></span>
                                <span class="icon-right glyphicon glyphicon-briefcase"></span>
                                <span>API自动化</span>
                            </a>
                            <ul class="nav nav-list nav-child">
                                <li><a href="#"><span class="icon-left glyphicon glyphicon-signal"
                                                      aria-hidden="true"></span><span>自动执行结果</span></a></li>
                                <li><a href="#"><span class="icon-left glyphicon glyphicon-flash"
                                                      aria-hidden="true"></span><span>失败原因</span></a></li>
                                <li><a href="#"><span class="icon-left glyphicon glyphicon-tasks"
                                                      aria-hidden="true"></span><span>CASE完成情况</span></a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#">
                                <span class="icon-left glyphicon glyphicon-wrench" aria-hidden="true"></span>
                                <span class="icon-right glyphicon glyphicon-chevron-up"></span>
                                <span>扩展小工具</span>
                            </a>
                            <ul class="nav nav-list nav-child">
                                <li><a href="#"><span class="icon-left glyphicon glyphicon-home"
                                                      aria-hidden="true"></span><span>Rezen One</span></a></li>
                                <li><a href="#"><span class="icon-left glyphicon glyphicon-home"
                                                      aria-hidden="true"></span><span>CRS</span></a></li>
                                <li><a href="#"><span class="icon-left glyphicon glyphicon-home"
                                                      aria-hidden="true"></span><span>Rezen Stay</span></a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </aside>
    <div class="container-warp">
        <section class="container-fluid is-vertical row">
            <header class="header navbar" style="height: auto; font-size: 12px; padding: 10px;">
                <div class="float-wrap">
                    <button class="icon-left glyphicon glyphicon-menu-hamburger"
                            aria-hidden="true" onclick="menuPullback('.menuDiv')"></button>
                    <div aria-label="Breadcrumb" role="navigation" class="ri-breadcrumb" style="display: inline-block;">
                        <span class="ri-breadcrumb__item"><span role="link" class="el-breadcrumb__inner">
                            <i class="fas fa-home"></i>首页
                                        </span>
                            <span role="presentation" class="el-breadcrumb__separator">/</span></span>
                        <span class="ri-breadcrumb__item"><span role="link" class="ri-breadcrumb__inner">
                            <span class="fas fa-globe-americas"></span> <span>网站管理</span></span><span
                                role="presentation" class="ri-breadcrumb__separator">/</span>
                        </span>
                    </div>
                </div>
            </header>

        </section>

        <div id="toolbar" >
{#            <ul class="searchul table table-striped table-hover table-bordered .table-condensed>#}
            <ul class="table table-striped table-hover table-bordered .table-condensed>
                <li class="lileft"><span class="input-icon"><input  type="text" id="keyword" value="" placeholder="Item Name"><i class="icon-search"></i></span></li>
                <li class="lileft"><button type="button" class="btn btn-mini btn-light" onclick="boottable.refresh();" title="搜索"><i class="icon-search"></i></button></li>
                <li class="lileft"><button type="button" class="btn btn-mini btn-success" onclick="boottable.add()"><i class="icon-plus"></i>添加</button></li>
                <li class="lileft"><button type="button" class="btn btn-mini btn-danger" onclick="boottable.delall();"><i class="icon-trash"></i>批量删除</button></li>
            </ul>
        </div>
        <table id="table"></table>
    </div>

</section>
</div>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
{#<!-- Just to make our placeholder images work. Don't actually copy the next line! -->#}
{#<script src="../../assets/js/vendor/holder.min.js"></script>#}
{#<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->#}
{#<script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>#}

<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>

<script>
    // 是否显示一级菜单折叠按钮
    var hsfoldIcon = false;
    // 需要控制隐藏/显示的span元素
    var hsSpanElement; // = hsfoldIcon ? 'ul.nav>li>a>span:not([class*="glyphicon "])': 'ul.nav>li>a>span:not([class*="icon-left "])';

    /** 一级菜单绑定单击事件(折叠/展开二级菜单) */
    $('ul.nav-first>li>a').click(function (event) {
        // 实现菜单折叠
        $(this).next('ul').slideToggle();
        $(this).children('span.icon-right').toggleClass('glyphicon-chevron-up').toggleClass('glyphicon-chevron-down');
        hsSpanElement = hsfoldIcon ? 'ul.nav>li>a>span:not([class*="glyphicon "])' : 'ul.nav>li>a>span:not([class*="icon-left "])';
        $(hsSpanElement).each(function () {
            if (menuIsShow) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });
    });
    $('ul.nav-first>li').click(function (event) {
        menuClick1(this);
    });
    $('ul.nav-first>li>ul.nav-child>li').click(function (event) {
        menuClick2(this);
    });

    /** 一级菜单绑定单击事件(触发样式和链接),obj是一级菜单li */
    function menuClick1(obj) {
        var objUl = $(obj).find('ul');
        var aHref = "/_xwq/content-wrapper/404.html ";
        if (objUl.html() == undefined || objUl.length <= 0) { // 无子菜单,触发单击事件
            // 去除所有二级菜单活动状态
            $('ul.nav-first>li>ul.nav-child>li').removeClass('borderLeft').removeClass('active');
            // 去除所有一级菜单活动状态
            $('ul.nav-first>li').removeClass('active');
            // 当前菜单(一级菜单)加上活动状态
            $(obj).addClass('active');
            // 获取a标签链接
            if (!($(obj).find('a').attr('aHref') == undefined || $(obj).find('a').attr('aHref') == '#' || $(obj).find('a').attr('aHref').trim() == '')) {
                aHref = $(obj).find('a').attr('aHref');
            }
            console.log("menuUrl: " + aHref);
            // $('.basepage_container_right_center').load(aHref);
        }
    }

    /** 二级菜单绑定单击事件(触发样式和链接),obj是二级菜单li */
    function menuClick2(obj) {
        var aHref = "/_xwq/content-wrapper/404.html ";
        // 去除所有二级菜单活动状态
        $('ul.nav-first>li>ul.nav-child>li').removeClass('borderLeft').removeClass('active');
        // 当前菜单及其同级菜单(二级菜单)加上状态
        $(obj).parent().children().each(function (i, v) {
            if ($(this).children('a').html() != $(obj).children('a').html()) {
                $(this).addClass('borderLeft');
            } else {
                $(this).addClass('active');
                return false;
            }
        });
        // 去除所有一级菜单活动状态
        $('ul.nav-first>li').removeClass('active');
        // 当前菜单的上级菜单(一级菜单)加上活动状态
        $(obj).parent().parent().addClass('active');
        // 获取a标签链接
        if (!($(obj).find('a').attr('aHref') == undefined || $(obj).find('a').attr('aHref') == '#' || $(obj).find('a').attr('aHref').trim() == '')) {
            aHref = $(obj).find('a').attr('aHref');
        }
        console.log("menuUrl: " + aHref);
        // $('.basepage_container_right_center').load(aHref);
    }

    var menuIsShow = true; // 菜单收缩标志
    var menuWidth; // 菜单宽度

    /**
     * 菜单收缩/展开
     * element 菜单所在容器宽度设置,例如'#menuDiv'
     */
    function menuPullback(element) {
        // 控制li>a>span隐藏状态
        hsSpanElement = hsfoldIcon ? 'ul.nav>li>a>span:([class*="glyphicon "])' : 'ul.nav>li>a>span:([class*="icon-left "])';
        $(hsSpanElement).each(function () {
            if ($(this).is(':hidden')) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });
        // 判断menuIsShow的状态
        if (menuIsShow) {
            menuWidth = 60;
            $(element).width(menuWidth); // 设置宽度
            // 修改标志位
            menuIsShow = false;
        } else {
            menuWidth = 230;
            $(element).width(menuWidth); // 设置宽度
            menuIsShow = true;
        }
    }

    /**
     * 文字化菜单(菜单展开)
     * element 菜单所在容器宽度设置,例如'#menuDiv'
     */
    function menuExtend(element) {
        // 控制li>a>span隐藏状态
        hsSpanElement = hsfoldIcon ? 'ul.nav>li>a>span:([class*="glyphicon "])' : 'ul.nav>li>a>span:([class*="icon-left "])';
        $(hsSpanElement).each(function () {
            $(this).show();
        });
        // 判断menuIsShow的状态
        menuWidth = 230;
        $(element).width(menuWidth); // 设置宽度
        menuIsShow = true;
    }

    /**
     * 图标化菜单(菜单收缩)
     * element 菜单所在容器宽度设置,例如'#menuDiv'
     */
    function menushrink(element) {
        // 控制li>a>span隐藏状态
        hsSpanElement = hsfoldIcon ? 'ul.nav>li>a>span:([class*="glyphicon "])' : 'ul.nav>li>a>span:([class*="icon-left "])';
        $(hsSpanElement).each(function () {
            $(this).hide();
        });
        // 判断menuIsShow的状态
        menuWidth = 60;
        $(element).width(menuWidth); // 设置宽度
        // 修改标志位
        menuIsShow = false;
    }

    $(function () {
        hsfoldIcon = true;

        var element = '.menuDiv';
        menuPullback(element); // 收缩菜单
        // 鼠标经过(展开菜单)
        $(element).mouseover(function () {
            menuExtend(element);
        });
        // 鼠标离开(收缩菜单)
        $(element).mouseout(function () {
            menushrink(element);
        });
    });
</script>

<script type="text/javascript" src="/static/js/jquery.min.js"></script>
<script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/static/js/bootstrap-table.js"></script>
<script type="text/javascript" src="/static/js/layer/layer.js"></script>
<script type="text/javascript">
    var boottable = {
        loading:function(){
            boottable.gridload();
        },
        gridload:function(){
            $("#table").bootstrapTable({
                url : '/data', 		//请求后台的URL（*）
                toolbar : '#toolbar',
                method : 'get', 				//请求方式（*）
                striped : true, 				//是否显示行间隔色
                cache : false, 					//是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                pagination : true, 				//是否显示分页（*）
                sidePagination : "server", 		//分页方式：client客户端分页，server服务端分页（*）
                pageNumber : 1, 				//初始化加载第一页，默认第一页
                pageSize : 10, 	//每页的记录行数（*）
                uniqueId : 'id', 			//每一行的唯一标识，一般为主键列
                clickToSelect : true, 			//是否启用点击选中行
                height : 400,
                queryParams:function(params){
                    params['KEYW'] = $.trim($("#keyword").val());
                    return params;
                },
                columns : [
                    { checkbox : true , align : 'center',valign : 'middle' },
                    { title : 'ID', field : 'id', align : 'left', valign : 'middle'},
                    { title : 'Item Name', field : 'name', align : 'left', valign : 'middle'},
                    { title : 'Price', field : 'price', align : 'left', valign : 'middle'},
                    { title : '操作', align : 'left', valign : 'middle',  formatter:function(value, row, index) {
                            return '<a class="btn btn-minier btn-info" onclick="boottable.edit(' + row.id + ')" title="修改"><i class="icon-edit"></i></a>&nbsp;<a class="btn btn-minier btn-danger" onclick="boottable.del(' + row.id + ');" title="删除"><i class="icon-trash"></i></a>';
                        }
                    }
                ],
                responseHandler : function(res) { return { total : res.total, rows : res.records }; } ,
                onSearch : function(text){
                    console.log("执行查询方法：查询值："+text);
                }
            });
        },
        refresh:function(){
            $('#table').bootstrapTable('refresh', { url : '/data' });
        },
        add:function(){
            var a = layer.open({
                type: 1,
                title: '添加',
                area: ['600px', '300px'],
                shadeClose: true,
                content: '<form class="bt-form pd20 pb70"><div class="line"><span class="tname">Item Name:</span><input type="text" class="bt-input-text" id="add_name" value="" style="width:330px"></div><div class="line"><span class="tname ">Price:</span><input type="text" class="bt-input-text" id="add_price" value="" style="width:330px"></div><div class="bt-form-submit-btn"><button type="button" class="btn btn-danger btn-sm" onclick="layer.closeAll()">关闭</button><button type="button" id="dlok" class="btn btn-success btn-sm dlok">确定</button></div></form>'
            });
            $("#dlok").click(function() {
                $.ajax({type: "POST",url: '/save',data :{ id: 0 ,name : $("#add_name").val(),price : $("#add_price").val() ,_ : Math.random()},cache : false,
                    success: function(data){
                        /*保存完成，关闭层*/
                        layer.close(a);
                        if(data.row == "ok"){
                            layer.msg("保存成功",{icon: 1});
                        }else{
                            layer.msg("保存失败"+data.message ,{icon: 2});
                        }
                        /*刷新列表*/
                        boottable.refresh();
                    },
                    error : function(XMLHttpRequest, textStatus, errorThrown) {
                        layer.msg(errorThrown,{icon: 2});
                    }
                });
            });
        },
        edit:function(id){
            /*ajax加载数据*/
            $.ajax({type: "POST",url: '/info',data :{ id: id ,_ : Math.random()},cache : false,
                success: function(data){
                    console.log(data)
                    var e = layer.open({
                        type: 1,
                        title: '修改',
                        area: ['600px', '300px'],
                        shadeClose: true,
                        content: '<div class="bt-form pd20 pb70"><input type="hidden" id="edit_id" value="'+data.row[0].id+'"><div class="line"><span class="tname">Item Name:</span><input type="text" class="bt-input-text" id="edit_name" value="'+data.row[0].name+'" style="width:330px"></div><div class="line"><span class="tname ">Price:</span><input type="text" class="bt-input-text" id="edit_price" value="'+data.row[0].price+'" style="width:330px"></div><div class="bt-form-submit-btn"><button type="button" class="btn btn-danger btn-sm" onclick="layer.closeAll()">关闭</button><button type="button" id="dlok" class="btn btn-success btn-sm dlok">确定</button></div></div>'
                    });
                    $("#dlok").click(function() {
                        $.ajax({type: "POST",url: '/save',data :{ id: $("#edit_id").val() ,name : $("#edit_name").val(),price : $("#edit_price").val() ,_ : Math.random()},cache : false,
                            success: function(data){
                                /*保存完成，关闭层*/
                                layer.close(e);
                                if(data.row == "ok"){
                                    layer.msg("保存成功",{icon: 1});
                                }else{
                                    layer.msg("保存失败"+data.message ,{icon: 2});
                                }
                                /*刷新列表*/
                                boottable.refresh();
                            },
                            error : function(XMLHttpRequest, textStatus, errorThrown) {
                                layer.msg(errorThrown,{icon: 2});
                            }
                        });
                    });
                },
                error : function(XMLHttpRequest, textStatus, errorThrown) {
                    layer.msg(errorThrown,{icon: 2});
                }
            });
        },
        del:function(id){
            var d = layer.confirm('确认删除数据？', { btn: ['确认','取消']},
                function(){
                    var dl = layer.msg('正在删除中...', { icon: 16, time: 1000 * 60, });
                    /*执行操作返回结果后关闭加载层*/
                    $.ajax({type: "POST",url: '/del',data :{ ids: id ,_ : Math.random()},cache : false,
                        success: function(data){
                            layer.close(dl);
                            /*提示成功或失败（【icon: 1】成功，【icon: 2】失败））*/
                            if(data.row == "ok"){
                                layer.msg("删除成功",{icon: 1});
                            }else{
                                layer.msg("删除失败"+data.message ,{icon: 2});
                            }
                            /*刷新列表*/
                            boottable.refresh();
                        },
                        error : function(XMLHttpRequest, textStatus, errorThrown) {
                            layer.msg(errorThrown,{icon: 2});
                        }
                    });
                },
                function(){
                    /*取消操作关闭层*/
                    layer.close(d);
                });
        },
        delall:function(){
            /*获取选中行数据*/
            var hrs = $("#table").bootstrapTable('getSelections');
            var strid = "";
            if (hrs.length < 1) {
                /*没有选中行*/
                layer.msg('请选择数据',{icon: 2});
            } else {
                for (var i = 0; i < hrs.length; i++) {
                    if(strid != ""){
                        strid += ",";
                    }
                    strid += hrs[i].id;
                }
            }
            /*判断行数据是否存在，存在即执行删除提示*/
            if(strid != ""){
                var d = layer.confirm('确认删除数据？', { btn: ['确认','取消']},
                    function(){
                        var dl = layer.msg('正在删除中...', { icon: 16, time: 1000 * 60, });
                        /*执行操作返回结果后关闭加载层*/
                        $.ajax({type: "POST",url: '/del',data :{ ids: strid ,_ : Math.random()},cache : false,
                            success: function(data){
                                layer.close(dl);
                                /*提示成功或失败（【icon: 1】成功，【icon: 2】失败））*/
                                if(data.row == "ok"){
                                    layer.msg("删除成功",{icon: 1});
                                }else{
                                    layer.msg("删除失败"+data.message ,{icon: 2});
                                }
                                /*刷新列表*/
                                boottable.refresh();
                            },
                            error : function(XMLHttpRequest, textStatus, errorThrown) {
                                layer.msg(errorThrown,{icon: 2});
                            }
                        });
                    },
                    function(){
                        /*取消操作关闭层*/
                        layer.close(d);
                    });
            }
        }
    }

    $(function () {
        boottable.loading();
    });
</script>
</body>
</html>
